#!/usr/bin/env bash

if [[ $# -eq 1 ]]; then
    selected=$1
else
    selected=$(find /home/potato/workplace -mindepth 4 -maxdepth 4 -type d -path "*/src/*" \
        | awk -F '/src/' '{split($1, parts, "/"); print $2 "("parts[length(parts)]")"}' \
        | sort -u \
        | fzf)
fi

if [[ -z $selected ]]; then
    exit 0
fi

package=$(echo "$selected" | sed -E 's|\((.*)\)||' | xargs)
project=$(echo "$selected" | grep -oP '(?<=\().*(?=\))')

package_path=$(find /home/potato/workplace -mindepth 4 -maxdepth 4 -type d -path "*/$project/src/$package" | head -n 1)

if [[ -z $package_path ]]; then
    echo "Error: Could not resolve the package path for the selected entry"
    exit 1
fi

cd "$package_path" || exit 1

exec $SHELL -l
