#!/usr/bin/env bash

base_dir="$HOME/github"

selected=$(find "$base_dir" -mindepth 2 -maxdepth 3 -type d -path "*/src/*" \
    | awk -F '/' '{print $(NF)"("$(NF-2)")"}' \
    | sort -u \
    | fzf)

if [[ -z $selected ]]; then
    exit 0
fi

package=$(echo "$selected" | sed -E 's|\((.*)\)||' | xargs)    # Extract PACKAGE before (PROJECT)
project=$(echo "$selected" | sed -E 's|.*\((.*)\)|\1|' | xargs) # Extract PROJECT inside parentheses

package_path="$base_dir/$project/src/$package"

if [[ ! -d $package_path ]]; then
    echo "Error: Package directory not found: $package_path"
    exit 1
fi

cd "$package_path" || exit 1

exec $SHELL -l
